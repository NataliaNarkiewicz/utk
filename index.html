<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RGB Lamp Controller Bluetooth</title>

<style>
body { background: #111; color: white; font-family: Arial, sans-serif; margin:0; padding:0;}
header { padding: 1rem; background: #222; text-align: center; font-size: 1.5rem; }

nav { display: flex; justify-content: center; background: #333; flex-wrap: wrap; }

nav button {
background: none;
border:none;
color:#ccc;
padding: 1rem 2rem;
cursor:pointer;
font-size: 1rem;
}

nav button.active {
background: #555;
color: #fff;
}

main { padding: 1rem; }

#connectionPage, #gridPage, #musicPage, #modsPage {
display:none;
}

#grid {
display: grid;
grid-template-columns: repeat(9, 40px);
grid-gap: 4px;
justify-content:center;
margin: 20px 0;
}

.cell {
width: 40px;
height: 40px;
background: black;
border-radius: 4px;
cursor:pointer;
}

.color-picker {
text-align: center;
margin-bottom: 15px;
}

.color-circle {
display: inline-block;
width: 35px;
height: 35px;
border-radius: 50%;
margin: 0 10px;
cursor: pointer;
border: 3px solid transparent;
}

.color-circle.selected {
border-color: yellow;
}

#modsPage button {
margin: 5px;
padding: 0.5rem 1rem;
background: #444;
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
}

button {
padding:10px 15px;
margin:5px;
cursor:pointer;
}

</style>
</head>

<body>

<header>RGB Lamp Controller Bluetooth</header>

<nav>
<button id="btnConnect" class="active">PoÅ‚Ä…czenie</button>
<button id="btnGrid">Siatka LED</button>
<button id="btnMusic">Mod muzyczny</button>
<button id="btnMods">Mody</button>
</nav>

<main>

<section id="connectionPage">
<button id="btnRequestBluetooth">PoÅ‚Ä…cz przez Bluetooth</button>
<p id="connStatus">Nie poÅ‚Ä…czono</p>
</section>

<section id="gridPage">

<div class="color-picker">
<div id="red" class="color-circle selected" style="background:red;"></div>
<div id="green" class="color-circle" style="background:green;"></div>
<div id="blue" class="color-circle" style="background:blue;"></div>
<div id="yellow" class="color-circle" style="background:yellow;"></div>
<div id="purple" class="color-circle" style="background:purple;"></div>
<div id="orange" class="color-circle" style="background:orange;"></div>
</div>

<div id="grid"></div>

<button id="btnSendGrid">WyÅ›lij do lampy</button>
<button id="btnVoice">ðŸŽ¤ Start nasÅ‚uchiwania</button>

<p id="sendStatus"></p>
<p id="voiceStatus"></p>

</section>

<section id="musicPage">
<p>Mod muzyczny (opcjonalny)</p>
</section>

<section id="modsPage">
<h3>Efekty</h3>
<button onclick="alert('Dodaj wÅ‚asny efekt')">Test efektu</button>
</section>

</main>

<script>

const NUM_LEDS = 81;


/* =========================
NAWIGACJA
========================= */

const btnConnect = document.getElementById('btnConnect');
const btnGrid = document.getElementById('btnGrid');
const btnMusic = document.getElementById('btnMusic');
const btnMods = document.getElementById('btnMods');

const connectionPage = document.getElementById('connectionPage');
const gridPage = document.getElementById('gridPage');
const musicPage = document.getElementById('musicPage');
const modsPage = document.getElementById('modsPage');

function showPage(page){

connectionPage.style.display="none";
gridPage.style.display="none";
musicPage.style.display="none";
modsPage.style.display="none";

page.style.display="block";

}

function setActiveButton(btn){

[btnConnect,btnGrid,btnMusic,btnMods]
.forEach(b=>b.classList.remove("active"));

btn.classList.add("active");

}

btnConnect.onclick=()=>{
showPage(connectionPage);
setActiveButton(btnConnect);
};

btnGrid.onclick=()=>{
showPage(gridPage);
setActiveButton(btnGrid);
};

btnMusic.onclick=()=>{
showPage(musicPage);
setActiveButton(btnMusic);
};

btnMods.onclick=()=>{
showPage(modsPage);
setActiveButton(btnMods);
};

showPage(connectionPage);


/* =========================
BLUETOOTH
========================= */

let writeCharacteristic;

const SERVICE_UUID='12345678-1234-1234-1234-1234567890ab';
const CHARACTERISTIC_UUID='87654321-4321-4321-4321-0987654321ba';

document
.getElementById("btnRequestBluetooth")
.onclick=async()=>{

try{

const device=
await navigator.bluetooth.requestDevice({
acceptAllDevices:true,
optionalServices:[SERVICE_UUID]
});

const server=
await device.gatt.connect();

const service=
await server.getPrimaryService(SERVICE_UUID);

writeCharacteristic=
await service.getCharacteristic(CHARACTERISTIC_UUID);

connStatus.textContent="PoÅ‚Ä…czono";

}
catch(e){

connStatus.textContent="BÅ‚Ä…d: "+e;

}

};


/* =========================
GRID
========================= */

const grid=document.getElementById("grid");

const colors={

red:"#FF0000",
green:"#00FF00",
blue:"#0000FF",
yellow:"#FFFF00",
purple:"#800080",
orange:"#FFA500",
black:"#000000"

};

let selectedColor="red";

let cells=[];


document
.querySelectorAll(".color-circle")
.forEach(el=>{

el.onclick=()=>{

document
.querySelectorAll(".color-circle")
.forEach(c=>c.classList.remove("selected"));

el.classList.add("selected");

selectedColor=el.id;

};

});


for(let i=0;i<NUM_LEDS;i++){

const cell=document.createElement("div");

cell.className="cell";

cell.style.backgroundColor=colors.black;

cell.onclick=()=>{

cell.style.backgroundColor=
colors[selectedColor];

};

grid.appendChild(cell);

cells.push(cell);

}


/* =========================
WYÅšLIJ DO LAMPY
========================= */

const sendStatus=
document.getElementById("sendStatus");

document
.getElementById("btnSendGrid")
.onclick=sendToLamp;


async function sendToLamp(){

if(!writeCharacteristic){

sendStatus.textContent=
"Nie poÅ‚Ä…czono";

return;

}

let data=
new Uint8Array(NUM_LEDS*3);

for(let i=0;i<NUM_LEDS;i++){

let rgb=parseRGB(
cells[i].style.backgroundColor
);

data[i*3]=rgb.r;
data[i*3+1]=rgb.g;
data[i*3+2]=rgb.b;

}

await writeCharacteristic.writeValue(data);

sendStatus.textContent=
"WysÅ‚ano do lampy";

}


function parseRGB(rgb){

const m=rgb.match(/\d+/g);

return{

r:parseInt(m[0]),
g:parseInt(m[1]),
b:parseInt(m[2])

};

}


/* =========================
STEROWANIE GÅOSEM
========================= */

const voiceBtn=
document.getElementById("btnVoice");

const voiceStatus=
document.getElementById("voiceStatus");

const voiceMap={

"czerwony":"red",
"zielony":"green",
"niebieski":"blue",
"Å¼Ã³Å‚ty":"yellow",
"zolty":"yellow",
"fioletowy":"purple",
"pomaraÅ„czowy":"orange",
"pomaranczowy":"orange",
"czarny":"black"

};

let recognition;
let listening=false;


voiceBtn.onclick=()=>{

const SpeechRecognition=
window.SpeechRecognition||
window.webkitSpeechRecognition;

if(!SpeechRecognition){

voiceStatus.textContent=
"Brak obsÅ‚ugi gÅ‚osu";

return;

}

if(!recognition){

recognition=
new SpeechRecognition();

recognition.lang="pl-PL";

recognition.continuous=true;

recognition.onresult=
async(event)=>{

let text=
event.results[
event.results.length-1][0]
.transcript
.toLowerCase();

voiceStatus.textContent=
"UsÅ‚yszano: "+text;


for(let word in voiceMap){

if(text.includes(word)){

let color=
voiceMap[word];

selectedColor=color;

document
.querySelectorAll(".color-circle")
.forEach(c=>
c.classList.remove("selected"));

let el=
document.getElementById(color);

if(el)
el.classList.add("selected");


cells.forEach(cell=>
cell.style.backgroundColor=
colors[color]
);


await sendToLamp();

break;

}

}

};

}


if(!listening){

recognition.start();

voiceBtn.textContent=
"Stop nasÅ‚uchiwania";

voiceStatus.textContent=
"NasÅ‚uchiwanie...";

listening=true;

}
else{

recognition.stop();

voiceBtn.textContent=
"Start nasÅ‚uchiwania";

voiceStatus.textContent=
"Zatrzymano";

listening=false;

}

};

</script>

</body>
</html>
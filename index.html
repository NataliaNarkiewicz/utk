<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RGB Lamp Controller Bluetooth + Voice</title>

<style>
body { background:#111; color:white; font-family:Arial; margin:0; transition:background 0.3s;}
header { background:#222; padding:1rem; text-align:center; font-size:1.5rem }
nav { display:flex; justify-content:center; background:#333; flex-wrap:wrap }
nav button { background:none; border:none; color:#ccc; padding:1rem 1.5rem; cursor:pointer }
nav button.active { background:#555; color:white }
main { padding:1rem }
section { display:none }

button { padding:0.5rem 1rem; margin:5px; background:#444; color:white; border:none; border-radius:4px }
</style>
</head>

<body>

<header>RGB Lamp Controller Bluetooth + Voice</header>

<nav>
<button id="btnConnect" class="active">PoÅ‚Ä…czenie</button>
<button id="btnVoice">GÅ‚os</button>
</nav>

<main>

<section id="connectionPage">
<button id="btnRequestBluetooth">ðŸ”µ PoÅ‚Ä…cz z ESP32 (BLE)</button>
<p id="connStatus">Nie poÅ‚Ä…czono</p>
</section>

<section id="voicePage">
<h3>Sterowanie gÅ‚osem ðŸŽ¤</h3>
<button id="btnVoiceStart">Start nagrywania</button>
<p id="voiceText">UsÅ‚yszano: </p>
<p id="detectedColor">Kolor: brak</p>
<button id="btnSendColor">WyÅ›lij do lampy</button>
</section>

</main>

<script>
const SERVICE_UUID = '12345678-1234-1234-1234-1234567890ab';
const CHARACTERISTIC_UUID = '87654321-4321-4321-4321-0987654321ba';

let writeCharacteristic = null;
let currentColor = null;

/* ---------------- NAWIGACJA ---------------- */
const pages = {
btnConnect:'connectionPage',
btnVoice:'voicePage'
};

Object.keys(pages).forEach(id=>{
document.getElementById(id).onclick=()=>{
document.querySelectorAll('section').forEach(s=>s.style.display='none');
document.getElementById(pages[id]).style.display='block';
document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
document.getElementById(id).classList.add('active');
}
});
document.getElementById('connectionPage').style.display='block';

/* ---------------- BLE ---------------- */
document.getElementById('btnRequestBluetooth').onclick=async()=>{
try{
const device = await navigator.bluetooth.requestDevice({
acceptAllDevices:true,
optionalServices:[SERVICE_UUID]
});
const server = await device.gatt.connect();
const service = await server.getPrimaryService(SERVICE_UUID);
writeCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
document.getElementById('connStatus').textContent = "PoÅ‚Ä…czono z " + device.name;
}catch(e){
document.getElementById('connStatus').textContent = "BÅ‚Ä…d: " + e.message;
}
};

async function sendTextBLE(text){
if(!writeCharacteristic){
alert("Najpierw poÅ‚Ä…cz z ESP32!");
return;
}
const encoder = new TextEncoder();
await writeCharacteristic.writeValue(encoder.encode(text));
}

/* ---------------- VOICE ---------------- */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

const colorMap = {
"czerwony":"red",
"zielony":"green",
"niebieski":"blue",
"Å¼Ã³Å‚ty":"yellow",
"zolty":"yellow",
"rÃ³Å¼owy":"pink",
"rozowy":"pink",
"pomaraÅ„czowy":"orange",
"pomaranczowy":"orange",
"fioletowy":"purple"
};

if(SpeechRecognition){
const recognition = new SpeechRecognition();
recognition.lang = "pl-PL";
recognition.continuous = false;
recognition.interimResults = false;

document.getElementById('btnVoiceStart').onclick=()=>{
recognition.start();
document.getElementById('voiceText').textContent="NasÅ‚uchiwanie...";
};

recognition.onresult = (e)=>{
const text = e.results[0][0].transcript.toLowerCase();
document.getElementById('voiceText').textContent = "UsÅ‚yszano: " + text;

let foundColor = null;
for(let key in colorMap){
if(text.includes(key)){
foundColor = colorMap[key];
break;
}
}

if(foundColor){
currentColor = foundColor;
document.getElementById('detectedColor').textContent = "Kolor: " + foundColor;
document.body.style.backgroundColor = foundColor;
}else{
currentColor = null;
document.getElementById('detectedColor').textContent = "Nie rozpoznano koloru";
}
};

recognition.onerror = (e)=>{
document.getElementById('voiceText').textContent = "BÅ‚Ä…d mikrofonu";
};

}else{
document.getElementById('voiceText').textContent = "Brak obsÅ‚ugi Web Speech API (Chrome)";
}

/* ---------------- PRZYCISK WYÅšLIJ ---------------- */
document.getElementById('btnSendColor').onclick = async()=>{
if(!currentColor){
alert("Najpierw rozpoznaj kolor gÅ‚osem!");
return;
}
await sendTextBLE(currentColor);
alert("WysÅ‚ano kolor: " + currentColor);
};
</script>

</body>
</html>
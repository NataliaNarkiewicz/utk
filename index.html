<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RGB Lamp Voice Control</title>

<style>
body { background:#111; color:white; font-family:Arial; margin:0; text-align:center }
header { background:#222; padding:1rem; font-size:1.5rem }
section { padding:1rem }
button { padding:0.7rem 1.2rem; margin:10px; background:#444; color:white; border:none; border-radius:6px; font-size:1rem }
button:hover { background:#666 }
#detectedColor { font-size:1.5rem; margin-top:15px }
</style>
</head>

<body>

<header>RGB Lamp â€“ Sterowanie GÅ‚osem</header>

<section>
<button id="btnConnect">ðŸ”µ PoÅ‚Ä…cz z ESP32</button>
<p id="connStatus">Nie poÅ‚Ä…czono</p>
</section>

<section>
<h3>Sterowanie gÅ‚osem ðŸŽ¤</h3>
<button id="btnVoice">Start nagrywania</button>
<p id="voiceText"></p>
<p id="detectedColor">Kolor: brak</p>
<button id="btnSendColor">WyÅ›lij do lampy</button>
</section>

<script>
const SERVICE_UUID = '12345678-1234-1234-1234-1234567890ab';
const CHARACTERISTIC_UUID = '87654321-4321-4321-4321-0987654321ba';

let writeCharacteristic = null;
let currentColor = null;

/* ---------------- BLE ---------------- */
document.getElementById("btnConnect").onclick = async () => {
try{
const device = await navigator.bluetooth.requestDevice({
acceptAllDevices: true,
optionalServices: [SERVICE_UUID]
});

const server = await device.gatt.connect();
const service = await server.getPrimaryService(SERVICE_UUID);
writeCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);

document.getElementById("connStatus").textContent = "PoÅ‚Ä…czono z " + device.name;

}catch(error){
document.getElementById("connStatus").textContent = "BÅ‚Ä…d: " + error.message;
}
};

async function sendTextBLE(text){
if(!writeCharacteristic){
alert("Najpierw poÅ‚Ä…cz z ESP32!");
return;
}
const encoder = new TextEncoder();
await writeCharacteristic.writeValue(encoder.encode(text));
}

/* ---------------- VOICE ---------------- */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

const colorMap = {
"czerwony":"red",
"zielony":"green",
"niebieski":"blue",
"Å¼Ã³Å‚ty":"yellow",
"zolty":"yellow",
"rÃ³Å¼owy":"pink",
"rozowy":"pink",
"pomaraÅ„czowy":"orange",
"pomaranczowy":"orange",
"fioletowy":"purple"
};

if(SpeechRecognition){

const recognition = new SpeechRecognition();
recognition.lang = "pl-PL";

document.getElementById("btnVoice").onclick = () => {
recognition.start();
};

recognition.onresult = (event) => {

const text = event.results[0][0].transcript.toLowerCase();
document.getElementById("voiceText").textContent = "UsÅ‚yszano: " + text;

let found = null;

for (let key in colorMap){
if(text.includes(key)){
found = colorMap[key];
break;
}
}

if(found){
currentColor = found;
document.getElementById("detectedColor").textContent = "Kolor: " + found;
document.body.style.backgroundColor = found;
}else{
currentColor = null;
document.getElementById("detectedColor").textContent = "Nie rozpoznano koloru";
}

};

}else{
document.getElementById("voiceText").textContent = "Brak obsÅ‚ugi Web Speech API (Chrome)";
}

/* ---------------- PRZYCISK WYÅšLIJ ---------------- */
document.getElementById("btnSendColor").onclick = async () => {
if(!currentColor){
alert("Najpierw rozpoznaj kolor gÅ‚osem!");
return;
}

await sendTextBLE(currentColor);
alert("WysÅ‚ano: " + currentColor);
};
</script>

</body>
</html>